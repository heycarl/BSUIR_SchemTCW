\section{Разработка принципиальной схемы}
\label{sec:principal}

\subsection{Расчет мощности элементов схемы}
Потребляемая мощность разрабатываемого устройства равна сумме мощностей, потребляемых его элементами. Расчет мощности элементов схемы устройства управления и самого устройства представлены в таблице ниже.

\begin{table}[ht]
    \caption{Расчет мощности элементов схемы}
    \label{table:power_calc}
    \begin{tabular}{|llll|l|}
        \hline
        \multicolumn{1}{|l|}{Блок}                    & \multicolumn{1}{l|}{U, В} & \multicolumn{1}{l|}{I, мА} & Кол-во & P, мВт  \\ \hline
        \multicolumn{1}{|l|}{Микроконтроллер}         & \multicolumn{1}{l|}{3.3}  & \multicolumn{1}{l|}{150}   & 1      & $495$   \\ \hline
        \multicolumn{1}{|l|}{Преобразователь уровней} & \multicolumn{1}{l|}{5}    & \multicolumn{1}{l|}{4.5}   & 3      & $67.5$  \\ \hline
        \multicolumn{1}{|l|}{Индикация}               & \multicolumn{1}{l|}{3.3}  & \multicolumn{1}{l|}{20}    & 1      & $66$    \\ \hline
        \multicolumn{4}{|l|}{Суммарная мощность}                                                                        & $628.6$ \\ \hline
    \end{tabular}
\end{table}

В реализованной схеме используются микроконтроллер STM32F103RCT6, модуль преобразования уровней TXS0108EPWR и TXS0104EYZTR, светодиод CK1P1G1BB7R3R3. Таким образом потребляемая мощность будет равна: \(P = \sum P = 495 + 67.5 + 66 = 628.5\)мВт. Учитывая поправочный коэффициент в 20\%, максимальная потребляемая мощность составит \(754.2 мВт\).

Рассчитаем потребляемый ток:
\[I=\frac{\sum P}{U_{cons}}=\frac{754.2}{5}=150.84\text{ мА}\]

\subsection{Разработка блока питания}
Блок питания включает в себя несколько элементов:
\begin{itemize}
    \item Схема защиты от смены полярности
    \item Схема фильтрации от помех по питанию
    \item Преобразование входного напряжения 5 В в 3.3 В
    \item Индикацию наличия питания
\end{itemize}

\subsubsection{Схема защиты от смены полярности}
Данная схема\cite{schemt} включает в себя диод шотки, конденсатор номинал $100$ мкФ, резистор $100$ кОм и \textit{P-MOSFET AO3401A}.

\subsubsection{Схема фильтрации от помех}
Реализована за счет использования нескольких фильтрующих керамических конденсаторов номиналом $100$ мФ

\subsubsection{Преобразование входного напряжения}
Реализована используя микросхему \textit{AMS1117-3.3}. В качестве ее обвязки\cite{ams1117_datasheet} используются нескольких фильтрующих керамических конденсаторов номиналом $100$ мкФ , $100$ нФ.

\subsubsection{Индикацию наличия питания}
Реализована подключением светодиода через резистор номиналом $500$ Ом. Светодиод обозначает наличие питания на линии 3.3 В

\subsection{Разработка блока микроконтроллера}
\subsubsection{Тактирование}
Используется внешний кварцевый резонатор \textit{NX2520SA}. Для его корректной работы необходима установка небольших емкостей на входе и выходе резонатора. Емкости 10 пФ, 0.1 мкФ подобраны исходя из документации на резонатор. 
\subsubsection{Отладка, внешние коммуникации}
\begin{itemize}
    \item Отладка - вывод соответственно \textit{SWCLK, SWDIO} микроконтроллера
    \item Коммуникации с внешними устройствами - вывод соответственно \textit{USART, I2C} микроконтроллера
\end{itemize}


\subsection{Разработка блока преобразования уровней}
Для исправления проблемы несовместимости уровней работы субмодуля и микроконтроллера используются \textit{TXS0108EPWR} и \textit{TXS0104EPWR} в качестве 8 и 4х канальных преобразователей.\\
Для работы преобразователя, согласно документации\cite{shifter_datasheet}, необходимо подать на входы \textit{VCCA} и \textit{VCCB} необходимые входные и выходные уровни. Желательно использовать емкости для фильтрации входящего питания. Используются емкости на $0.1$ мкФ.